<?xml version="1.0" encoding="UTF-8"?>
<Configuration status="ERROR" monitorInterval="60">
    <Properties>
        <!-- Base log directory for production -->
        <Property name="LOG_DIR">${env:LOG_DIR:-/app/logs}</Property>
        <Property name="APP_NAME">aihr-gateway-prod</Property>

        <!-- Production log patterns (structured and efficient) -->
        <Property name="CONSOLE_LOG_PATTERN">%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %logger{36} -
            %msg%n</Property>
        <Property name="FILE_LOG_PATTERN">%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level [%X{traceId}]
            %logger{36} - %msg%n</Property>
        <Property name="JSON_LOG_PATTERN">
            {"timestamp":"%d{yyyy-MM-dd'T'HH:mm:ss.SSSZ}","level":"%-5level","thread":"%t","logger":"%logger{36}","message":"%msg","traceId":"%X{traceId}"}%n</Property>

        <!-- Rolling policy settings (production optimized) -->
        <Property name="MAX_FILE_SIZE">50MB</Property>
        <Property name="MAX_HISTORY">60</Property>
        <Property name="TOTAL_SIZE_CAP">1GB</Property>
    </Properties>

    <Appenders>
        <!-- Console Appender (minimal in production) -->
        <Console name="ConsoleAppender" target="SYSTEM_OUT">
            <PatternLayout pattern="${CONSOLE_LOG_PATTERN}" />
            <ThresholdFilter level="WARN" onMatch="ACCEPT" onMismatch="DENY" />
        </Console>

        <!-- Main Application Log (JSON format for log aggregation) -->
        <RollingFile name="ProdAppFileAppender" fileName="${LOG_DIR}/${APP_NAME}-app.log"
            filePattern="${LOG_DIR}/${APP_NAME}-app-%d{yyyy-MM-dd}-%i.log.gz">
            <PatternLayout pattern="${JSON_LOG_PATTERN}" />
            <Policies>
                <TimeBasedTriggeringPolicy />
                <SizeBasedTriggeringPolicy size="${MAX_FILE_SIZE}" />
            </Policies>
            <DefaultRolloverStrategy max="${MAX_HISTORY}" compressionLevel="9">
                <Delete basePath="${LOG_DIR}" maxDepth="1">
                    <IfFileName glob="${APP_NAME}-app-*.log.gz" />
                    <IfAccumulatedFileSize exceeds="${TOTAL_SIZE_CAP}" />
                </Delete>
            </DefaultRolloverStrategy>
        </RollingFile>

        <!-- Error Log (Critical issues) -->
        <RollingFile name="ProdErrorFileAppender" fileName="${LOG_DIR}/${APP_NAME}-error.log"
            filePattern="${LOG_DIR}/${APP_NAME}-error-%d{yyyy-MM-dd}-%i.log.gz">
            <PatternLayout pattern="${FILE_LOG_PATTERN}" />
            <ThresholdFilter level="ERROR" onMatch="ACCEPT" onMismatch="DENY" />
            <Policies>
                <TimeBasedTriggeringPolicy />
                <SizeBasedTriggeringPolicy size="${MAX_FILE_SIZE}" />
            </Policies>
            <DefaultRolloverStrategy max="${MAX_HISTORY}" compressionLevel="9">
                <Delete basePath="${LOG_DIR}" maxDepth="1">
                    <IfFileName glob="${APP_NAME}-error-*.log.gz" />
                    <IfAccumulatedFileSize exceeds="500MB" />
                </Delete>
            </DefaultRolloverStrategy>
        </RollingFile>

        <!-- Security Audit Log -->
        <RollingFile name="ProdSecurityFileAppender"
            fileName="${LOG_DIR}/${APP_NAME}-security-audit.log"
            filePattern="${LOG_DIR}/${APP_NAME}-security-audit-%d{yyyy-MM-dd}-%i.log.gz">
            <PatternLayout pattern="${FILE_LOG_PATTERN}" />
            <Policies>
                <TimeBasedTriggeringPolicy />
                <SizeBasedTriggeringPolicy size="${MAX_FILE_SIZE}" />
            </Policies>
            <DefaultRolloverStrategy max="90" compressionLevel="9">
                <Delete basePath="${LOG_DIR}" maxDepth="1">
                    <IfFileName glob="${APP_NAME}-security-audit-*.log.gz" />
                    <IfAccumulatedFileSize exceeds="500MB" />
                </Delete>
            </DefaultRolloverStrategy>
        </RollingFile>

        <!-- Performance Log -->
        <RollingFile name="ProdPerformanceFileAppender"
            fileName="${LOG_DIR}/${APP_NAME}-performance.log"
            filePattern="${LOG_DIR}/${APP_NAME}-performance-%d{yyyy-MM-dd}-%i.log.gz">
            <PatternLayout pattern="${FILE_LOG_PATTERN}" />
            <Policies>
                <TimeBasedTriggeringPolicy />
                <SizeBasedTriggeringPolicy size="20MB" />
            </Policies>
            <DefaultRolloverStrategy max="30" compressionLevel="9" />
        </RollingFile>

        <!-- Access Log for API calls -->
        <RollingFile name="ProdAccessFileAppender" fileName="${LOG_DIR}/${APP_NAME}-access.log"
            filePattern="${LOG_DIR}/${APP_NAME}-access-%d{yyyy-MM-dd}-%i.log.gz">
            <PatternLayout pattern="${JSON_LOG_PATTERN}" />
            <Policies>
                <TimeBasedTriggeringPolicy />
                <SizeBasedTriggeringPolicy size="100MB" />
            </Policies>
            <DefaultRolloverStrategy max="30" compressionLevel="9">
                <Delete basePath="${LOG_DIR}" maxDepth="1">
                    <IfFileName glob="${APP_NAME}-access-*.log.gz" />
                    <IfAccumulatedFileSize exceeds="2GB" />
                </Delete>
            </DefaultRolloverStrategy>
        </RollingFile>
    </Appenders>

    <Loggers>
        <!-- Application loggers (INFO level for production) -->
        <Logger name="com.aihr" level="INFO" additivity="false">
            <AppenderRef ref="ProdAppFileAppender" />
            <AppenderRef ref="ProdErrorFileAppender" />
        </Logger>

        <!-- Security audit logger -->
        <Logger name="com.aihr.security" level="INFO" additivity="false">
            <AppenderRef ref="ProdSecurityFileAppender" />
            <AppenderRef ref="ProdErrorFileAppender" />
        </Logger>

        <!-- Performance logger -->
        <Logger name="com.aihr.performance" level="INFO" additivity="false">
            <AppenderRef ref="ProdPerformanceFileAppender" />
        </Logger>

        <!-- Access logger -->
        <Logger name="com.aihr.access" level="INFO" additivity="false">
            <AppenderRef ref="ProdAccessFileAppender" />
        </Logger>

        <!-- Spring Security (minimal logging) -->
        <Logger name="org.springframework.security" level="WARN" additivity="false">
            <AppenderRef ref="ProdSecurityFileAppender" />
            <AppenderRef ref="ProdErrorFileAppender" />
        </Logger>

        <!-- Database (errors only) -->
        <Logger name="org.hibernate" level="ERROR" />
        <Logger name="org.postgresql" level="ERROR" />

        <!-- Spring Framework (errors and warnings only) -->
        <Logger name="org.springframework" level="WARN" />
        <Logger name="org.springframework.boot" level="INFO" />

        <!-- Third-party libraries (errors only) -->
        <Logger name="io.jsonwebtoken" level="ERROR" />
        <Logger name="org.apache" level="WARN" />

        <!-- Root logger (WARNING level for production) -->
        <Root level="WARN">
            <AppenderRef ref="ConsoleAppender" />
            <AppenderRef ref="ProdAppFileAppender" />
            <AppenderRef ref="ProdErrorFileAppender" />
        </Root>
    </Loggers>
</Configuration> 